<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.4 Work with Models | Spatial model with R</title>
  <meta name="description" content="This is an ice breaking activity to spatial model with R." />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="3.4 Work with Models | Spatial model with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is an ice breaking activity to spatial model with R." />
  <meta name="github-repo" content="fgazzelloni/How-to-Spatial-Modeling-with-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.4 Work with Models | Spatial model with R" />
  
  <meta name="twitter:description" content="This is an ice breaking activity to spatial model with R." />
  

<meta name="author" content="Federica Gazzelloni" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="make-a-grid.html"/>
<link rel="next" href="case-study-2-disease-mapping.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial modeling with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="case-study-rana-pretiosa.html"><a href="case-study-rana-pretiosa.html"><i class="fa fa-check"></i><b>3</b> Case study: Rana Pretiosa</a>
<ul>
<li class="chapter" data-level="3.0.1" data-path="case-study-rana-pretiosa.html"><a href="case-study-rana-pretiosa.html#get-started-making-a-map"><i class="fa fa-check"></i><b>3.0.1</b> Get started making a map!</a></li>
<li class="chapter" data-level="3.1" data-path="look-at-oregonfrogs-data.html"><a href="look-at-oregonfrogs-data.html"><i class="fa fa-check"></i><b>3.1</b> Look at oregonfrogs data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="look-at-oregonfrogs-data.html"><a href="look-at-oregonfrogs-data.html#lets-map-the-lake"><i class="fa fa-check"></i><b>3.1.1</b> Let’s map the lake!</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="time-as-coordinate.html"><a href="time-as-coordinate.html"><i class="fa fa-check"></i><b>3.2</b> Time as coordinate</a></li>
<li class="chapter" data-level="3.3" data-path="make-a-grid.html"><a href="make-a-grid.html"><i class="fa fa-check"></i><b>3.3</b> Make a grid</a></li>
<li class="chapter" data-level="3.4" data-path="work-with-models.html"><a href="work-with-models.html"><i class="fa fa-check"></i><b>3.4</b> Work with Models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="case-study-2-disease-mapping.html"><a href="case-study-2-disease-mapping.html"><i class="fa fa-check"></i><b>4</b> Case study 2: Disease mapping</a></li>
<li class="chapter" data-level="5" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>5</b> Conclusion</a></li>
<li class="chapter" data-level="6" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>6</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial model with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="work-with-models" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Work with Models<a href="work-with-models.html#work-with-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Packages functionality from rgeos,raster,rgdal,terra packages are included in {sf},and {dismo} so we don’t need to load them.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="work-with-models.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dismo)  <span class="co"># for modeling</span></span></code></pre></div>
<p>Here we use <strong>wrld_simpl</strong> data from {maptools}, to be able to use the <code>plot()</code> function faster, you can install the package or load it because data is included in the <code>/data</code> folder as <code>.RData</code> format. We can load the <code>data/case_study_1.RData</code> to load all the data we need for this workshop, this is already been done at the very beginning of this chapter. In case you’d like to do that separately, just type: <code>load("data/case_study_1.RData")</code> and all data will be loaded in the global environment</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="work-with-models.html#cb25-1" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">&quot;world&quot;</span>)</span>
<span id="cb25-2"><a href="work-with-models.html#cb25-2" aria-hidden="true" tabindex="-1"></a>gbi_coords<span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x=</span>do_gbif2<span class="sc">$</span>longitude,<span class="at">y=</span>do_gbif2<span class="sc">$</span>latitude)</span>
<span id="cb25-3"><a href="work-with-models.html#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="work-with-models.html#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(world)<span class="sc">+</span></span>
<span id="cb25-5"><a href="work-with-models.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(long,lat,<span class="at">group=</span>group),<span class="at">fill=</span><span class="st">&quot;grey90&quot;</span>,<span class="at">color=</span><span class="st">&quot;grey30&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-6"><a href="work-with-models.html#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data=</span>states, <span class="fu">aes</span>(long,lat,<span class="at">group=</span>group),<span class="at">color=</span><span class="st">&quot;grey40&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-7"><a href="work-with-models.html#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> gbi_coords, <span class="fu">aes</span>(x,y),</span>
<span id="cb25-8"><a href="work-with-models.html#cb25-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;pink&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-9"><a href="work-with-models.html#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>,<span class="sc">-</span><span class="dv">90</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">35</span>,<span class="dv">65</span>))<span class="sc">+</span></span>
<span id="cb25-10"><a href="work-with-models.html#cb25-10" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>()</span></code></pre></div>
<p>This is a raster stack composed of 19 raster layers.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="work-with-models.html#cb26-1" aria-hidden="true" tabindex="-1"></a>frogs <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">long=</span>do_gbif2<span class="sc">$</span>longitude,<span class="at">lat=</span>do_gbif2<span class="sc">$</span>latitude)</span>
<span id="cb26-2"><a href="work-with-models.html#cb26-2" aria-hidden="true" tabindex="-1"></a>climate <span class="ot">&lt;-</span> dismo<span class="sc">::</span><span class="fu">getData</span>(<span class="st">&quot;worldclim&quot;</span>,<span class="at">download =</span> T,<span class="at">var=</span><span class="st">&quot;bio&quot;</span>,<span class="at">res=</span><span class="fl">2.5</span>)</span>
<span id="cb26-3"><a href="work-with-models.html#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="work-with-models.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(climate,<span class="at">legend=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="images/climate_plot.png" width="1190" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="work-with-models.html#cb27-1" aria-hidden="true" tabindex="-1"></a>frog_climate <span class="ot">&lt;-</span> <span class="fu">extract</span>(climate,frogs)</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="work-with-models.html#cb28-1" aria-hidden="true" tabindex="-1"></a>frog_climate <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>     bio1 bio2 bio3 bio4 bio5 bio6 bio7 bio8 bio9 bio10 bio11 bio12 bio13 bio14
[1,]  100   85   34 5669  237  -11  248   32  171   171    27  1737   248    53
[2,]   72   88   33 6123  220  -43  263    1  151   151    -4  1514   225    47
[3,]   59   83   35 5268  194  -40  234    1  127   129    -3  1731   258    49
     bio15 bio16 bio17 bio18 bio19
[1,]    48   731   184   184   667
[2,]    50   656   161   161   599
[3,]    50   749   178   195   687</code></pre>
<p>Apply the <strong>Bioclim algorithm</strong> used for species distribution modeling, the classic <strong>climate-envelope-model</strong>. It computes the similarity of a location by comparing the values of environmental variables at any location to a percentile distribution of the values at known locations of occurrence. More info here: <code>?dismo::bioclim</code></p>
<p>We use the <code>pairs(x, v=NULL, pa='pa', hist=TRUE, cor=TRUE)</code> function to plot the results of the model, with options from the {dismo} package.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="work-with-models.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(dismo)</span>
<span id="cb30-2"><a href="work-with-models.html#cb30-2" aria-hidden="true" tabindex="-1"></a>bioclim.mod <span class="ot">&lt;-</span> dismo<span class="sc">::</span><span class="fu">bioclim</span>(frog_climate)</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="work-with-models.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(bioclim.mod,<span class="at">pa=</span><span class="st">&quot;pa&quot;</span>)</span></code></pre></div>
<p><img src="images/pairs_bioclim.png" width="1210" style="display: block; margin: auto;" /></p>
<p>Now, let’s build a stack with the <code>stack()</code> function, including all the bioclimatic layers from the original raster stack.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="work-with-models.html#cb32-1" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>()</span>
<span id="cb32-2"><a href="work-with-models.html#cb32-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">stack</span>(climate<span class="sc">$</span>bio1,climate<span class="sc">$</span>bio2,climate<span class="sc">$</span>bio3,</span>
<span id="cb32-3"><a href="work-with-models.html#cb32-3" aria-hidden="true" tabindex="-1"></a>                    climate<span class="sc">$</span>bio4,climate<span class="sc">$</span>bio5,</span>
<span id="cb32-4"><a href="work-with-models.html#cb32-4" aria-hidden="true" tabindex="-1"></a>                    climate<span class="sc">$</span>bio6,climate<span class="sc">$</span>bio7,climate<span class="sc">$</span>bio8,</span>
<span id="cb32-5"><a href="work-with-models.html#cb32-5" aria-hidden="true" tabindex="-1"></a>                    climate<span class="sc">$</span>bio9,climate<span class="sc">$</span>bio10,climate<span class="sc">$</span>bio11,</span>
<span id="cb32-6"><a href="work-with-models.html#cb32-6" aria-hidden="true" tabindex="-1"></a>                    climate<span class="sc">$</span>bio12,climate<span class="sc">$</span>bio13,climate<span class="sc">$</span>bio14,</span>
<span id="cb32-7"><a href="work-with-models.html#cb32-7" aria-hidden="true" tabindex="-1"></a>                    climate<span class="sc">$</span>bio15,climate<span class="sc">$</span>bio16,climate<span class="sc">$</span>bio17,</span>
<span id="cb32-8"><a href="work-with-models.html#cb32-8" aria-hidden="true" tabindex="-1"></a>                    climate<span class="sc">$</span>bio18,climate<span class="sc">$</span>bio19)</span>
<span id="cb32-9"><a href="work-with-models.html#cb32-9" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(predictors,bioclim.mod)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="work-with-models.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(predictions,<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>,<span class="sc">-</span><span class="dv">100</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">35</span>,<span class="dv">55</span>),<span class="at">axes=</span>T)</span></code></pre></div>
<p><img src="images/frogs_location_raster.png" width="604" style="display: block; margin: auto;" /></p>
<hr />

</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="make-a-grid.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="case-study-2-disease-mapping.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/fgazzelloni/How-to-Spatial-Modeling-with-R/edit/main/02-case_study_1.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
